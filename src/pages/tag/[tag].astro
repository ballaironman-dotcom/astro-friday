---
import { getCollection } from 'astro:content'
import BaseLayout from '~/layouts/Base.astro'
import { getPath } from '~/utils/path'

export async function getStaticPaths() {
  const postEntries = await getCollection('blog')

  const tags = postEntries.reduce((acc, entry) => [...new Set([...acc, ...(entry.data.tags || [])])], [])

  return tags.map(tag => ({
    params: { tag },
    props: {
      entries: postEntries.filter(entry => entry.data.tags?.includes(tag)),
    },
  }))
}

const { entries } = Astro.props
---

<BaseLayout>
  <ul>
    {entries.map(entry => (
      <li><a href={getPath('post', entry.slug)}>{entry.data.title}</a></li>
    ))}
  </ul>
</BaseLayout>
