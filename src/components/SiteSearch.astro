---
import Search from 'astro-pagefind/components/Search'

const options = {
  showImage: false,
  showSubResults: true,
}
---

<div
  id="component_site-search"
  class="hidden"
>
  <div
    class="component_site-search__mask"
    class:list={[
      'site-mask',
    ]}
  >
    <div
      class:list={[
        'site-mask__content',
      ]}
    >
      <Search id="search" className="pagefind-ui" uiOptions={options} />
    </div>

    <div
      class:list={[
        'absolute left-0 right-0 bottom-12 m-auto transform-translate-y-50% w-max flex flex-row justify-center items-center',
        'bg-primary rounded-10 site-shadow-40 site-opacity text-10',
        'sm:(hidden)',
        'component_site-search__close-button',
      ]}
    >
      <button
        class:list={[
          'i-ic:baseline-close',
        ]}
      ></button>
    </div>
  </div>
</div>

<script>
  const closeButton = document.querySelector('.component_site-search__close-button') as HTMLElement
  closeButton.addEventListener('click', e => {
    siteSearch.classList.add('hidden')
  })

  const siteSearch = document.querySelector('#component_site-search') as HTMLElement
  const siteSearchMask = document.querySelector('.component_site-search__mask') as HTMLElement

  siteSearchMask.addEventListener('click', e => {
    const isCurrentTarget = e.target === e.currentTarget
    const isCloseButtonHidden = window.getComputedStyle(closeButton).display === 'none'
    if (isCurrentTarget && isCloseButtonHidden) {
      siteSearch.classList.add('hidden')
    }
  })
</script>

<style is:inline>
  #component_site-search {
  }
  .pagefind-ui {
    height: 100%;
  }
  .pagefind-ui__form {
    position: relative;
    height: 100%;
  }

  .pagefind-ui__form::before {
    background-color: currentColor !important;
  }

  .pagefind-ui__drawer {
    position: absolute;
    bottom: 0;
    overflow-y: auto;
    overscroll-behavior: contain;
    width: 100%;
    height: calc(100% - calc(64px * var(--pagefind-ui-scale)));
  }

  .pagefind-ui__search-input {
    outline: none;
  }

  .pagefind-ui__result-thumb {
    display: none;
  }

  :root.dark {
    --pagefind-ui-primary: unset;
    --pagefind-ui-text: unset;
    --pagefind-ui-background: unset;
    --pagefind-ui-border: #F2F3F533;
    --pagefind-ui-tag: #152028;
  }
</style>
